(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[272],{7891:function(e,t,s){Promise.resolve().then(s.bind(s,6308))},6308:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w},dynamic:function(){return C},fetchCache:function(){return L}});var n,l,i,r,a,c,o=s(7437),d=s(2265),m=s(4660);let h={club:{name:"Trekanten",id:"9747fb19-5a24-4c8f-b049-78072dd70ff6"},title:"",leftFencer:{name:"Left Fencer"},rightFencer:{name:"Right Fencer"},touches:[],url:""},u=(0,m.Ue)(e=>({...h,setUploadedVideo:t=>e(()=>({url:t})),setPlayerRef:t=>e(()=>({playerRef:t})),getPlayerRef:()=>e(e=>({playerRef:e.playerRef})),setTitle:t=>e(()=>({title:t})),addTouch:t=>e(e=>({touches:[...e.touches,t]})),removeTouch:t=>e(e=>({touches:e.touches.filter(e=>e!==t)})),editTouch:t=>e(e=>({touches:e.touches.map(e=>e===t?t:e)})),getLeftFencer:()=>e(e=>({leftFencer:e.leftFencer})),getRightFencer:()=>e(e=>({rightFencer:e.rightFencer})),getTouches:()=>e(e=>({touches:e.touches})),setLeftFencer:t=>e(()=>({leftFencer:t})),setRightFencer:t=>e(()=>({rightFencer:t})),resetVideo:()=>e(()=>({...h}))}));function x(e){let{onCreate:t}=e,[s,n]=(0,d.useState)(""),[l,i]=(0,d.useState)(!1),r=async()=>{i(!0);let e=document.getElementById("create-fencer-modal");e&&e.showModal()},a=async()=>{try{await fetch("/api/fencers",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({fencer:{name:s},clubId:"9747fb19-5a24-4c8f-b049-78072dd70ff6"})}).then(e=>e.json()).then(e=>{t(e.name)}).catch(()=>{console.error("Error creating fencer")}),n("")}catch(e){console.error("Error creating fencer:",e)}finally{i(!1);let e=document.getElementById("create-fencer-modal");e&&e.close()}};return(0,o.jsx)("div",{className:"flex w-full justify-center items-center",children:(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("input",{type:"text",className:"input input-bordered",placeholder:"Enter fencer name",value:s,onChange:e=>n(e.target.value)}),(0,o.jsx)("button",{className:"btn btn-secondary ml-4",disabled:l||""===s,onClick:()=>r(),children:"Create Fencer"}),(0,o.jsx)("dialog",{id:"create-fencer-modal",className:"modal",children:(0,o.jsxs)("div",{className:"modal-box flex flex-col w-full",children:[(0,o.jsx)("h3",{className:"font-bold text-lg",children:"Are you sure?"}),(0,o.jsxs)("div",{className:"py-4",children:[(0,o.jsx)("span",{className:"",children:"ready to bring"}),(0,o.jsxs)("span",{className:"font-semibold",children:[" ",s," "]}),(0,o.jsx)("span",{children:"into existence?"})]}),(0,o.jsxs)("div",{className:"modal-action flex w-full justify-between",children:[(0,o.jsx)("form",{method:"dialog",children:(0,o.jsx)("button",{className:"btn btn-danger",children:"Nope"})}),(0,o.jsx)("button",{className:"btn btn-accent",onClick:()=>a(),children:l?"Create Fencer":"Creating..."})]})]})})]})})}let f=(0,m.Ue)(e=>({currentStep:0,setCurrentStep:t=>e({currentStep:t})}));function p(){let[e,t]=(0,d.useState)([]),[s,n]=(0,d.useState)(!0),l=u(e=>e.leftFencer),i=u(e=>e.rightFencer),r=f(e=>e.setCurrentStep),a=t=>{let s=e.find(e=>e.id===t);s?u.getState().setLeftFencer(s):console.error("Error setting left fencer")},c=t=>{let s=e.find(e=>e.id===t);s?u.getState().setRightFencer(s):console.error("Error setting right fencer")},m=async e=>{t(t=>[...t,{id:"new-id",name:e}])};return(0,d.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/fencers",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(e=>e.json()).then(e=>e).catch(()=>[]);t(e)}catch(e){console.error("Error fetching fencers:",e)}})().then(()=>n(!1))},[]),(0,o.jsxs)("div",{className:"flex flex-col w-full my-4 p-4",children:[s?(0,o.jsx)("div",{className:"flex w-full justify-center items-start min-h-[96px]",children:(0,o.jsx)("p",{className:"text-xl font-semibold",children:"\uD83E\uDD3A Fetching Fencers \uD83E\uDD3A"})}):(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsx)("div",{className:"flex w-full justify-center",children:(0,o.jsx)("p",{className:"text-xl font-semibold",children:"\uD83E\uDD3A Select Fencers \uD83E\uDD3A"})}),(0,o.jsxs)("div",{className:"flex w-full flex-row justify-evenly items-center my-8",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("label",{htmlFor:"leftFencer",className:"mx-4 text-md font-semibold",children:"Left Fencer:"}),(0,o.jsxs)("select",{id:"leftFencer",className:"select select-bordered",defaultValue:"",onChange:e=>a(e.target.value),children:[(0,o.jsx)("option",{disabled:!0,value:"",children:"Select Fencer"}),e.filter(e=>e.id!==i.id).map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("label",{htmlFor:"rightFencer",className:"mx-4 text-md font-semibold",children:"Right Fencer:"}),(0,o.jsxs)("select",{id:"rightFencer",className:"select select-bordered",defaultValue:"",onChange:e=>c(e.target.value),children:[(0,o.jsx)("option",{disabled:!0,value:"",children:"Select Fencer"}),e.filter(e=>e.id!==l.id).map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]})]}),(0,o.jsx)("div",{className:"divider w-full mx-8 font-bold",children:"OR"}),(0,o.jsx)("div",{className:"flex w-full flex-row justify-evenly items-center my-8",children:(0,o.jsx)(x,{onCreate:m})}),(0,o.jsx)("div",{className:"px-8 flex w-full justify-end",children:(0,o.jsx)("button",{className:"btn btn-primary",onClick:()=>{l&&i?r(2):console.error("Please select both left and right fencers.")},disabled:!(l&&i&&e.some(e=>e.id===l.id)&&e.some(e=>e.id===i.id)),children:"Next: Annotate Touches"})})]})}var N=s(429);function j(){let e=u(e=>e.url),t=u(e=>e.setUploadedVideo),s=u(e=>e.title),n=f(e=>e.setCurrentStep),[l,i]=(0,d.useState)(null),r=(0,d.useRef)(null);(0,d.useEffect)(()=>{u.getState().setPlayerRef(r)},[]);let a=e=>{u.getState().setTitle(e)},c=async()=>{let e=u.getState().title,t=u.getState().url;try{let s=await fetch(t),n=await s.blob(),l=new FormData;l.append("title",e),l.append("description","A video uploaded from the Fencing Time app"),l.append("file",n),await fetch("/api/tube",{method:"POST",body:l}).then(e=>e.json()).catch(()=>{console.error("Error uploading video")})}catch(e){console.error("Error uploading video:",e)}};return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"flex items-center w-full justify-start",children:[(0,o.jsx)("h2",{className:"px-8 text-xl",children:"Set video title:"}),(0,o.jsx)("input",{type:"text",placeholder:"Fencer's Fencing",id:"video-form",className:"input input-bordered w-full max-w-xs",value:s,onChange:e=>a(e.target.value),required:!0})]}),(0,o.jsxs)("div",{className:"w-full flex flex-col justify-evenly items-center my-8 p-16 min-h-[500px]",children:[!e&&(0,o.jsx)("div",{children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-32 h-32",children:(0,o.jsx)("path",{strokeLinecap:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"})})}),e&&(0,o.jsx)("div",{children:(0,o.jsx)(N.Z,{ref:r,url:e,onPlaying:()=>{},controls:!0})}),(0,o.jsx)("input",{type:"file",accept:"video/*",className:"mt-6 file-input file-input-bordered w-full max-w-xs",onChange:e=>{if(null!==e.target.files&&e.target.files.length>0){let s=e.target.files[0];t(URL.createObjectURL(s)),i(s)}else console.log("Error uploading video")}})]}),(0,o.jsxs)("div",{className:"px-8 flex w-full justify-end",children:[(0,o.jsx)("button",{onClick:()=>c(),className:"btn btn-primary",children:"Upload Video"}),(0,o.jsx)("button",{className:"btn btn-primary",onClick:()=>{s&&e&&n(1)},disabled:!s||!e,children:"Next: Select Fencers"})]})]})}(n=r||(r={})).CENTER_LINE="Center Line",n.LEFT_OF_CENTER_LINE="Left of Center Line",n.RIGHT_OF_CENTER_LINE="Right of Center Line",n.BEHIND_GUARD_LINE_RIGHT="Behind Right Guard Line",n.BEHIND_GUARD_LINE_LEFT="Behind Left Guard Line",n.NEAR_WARNING_LINE_RIGHT="Near Right Warning Line",n.NEAR_WARNING_LINE_LEFT="Near Left Warning Line",n.WARNING_ZONE_RIGHT="In Right Warning Zone",n.WARNING_ZONE_LEFT="In Left Warning Zone",n.BACK_LINE_RIGHT="On Right Back Line",n.BACK_LINE_LEFT="On Left Back Line";let T={type:null,pointAwardedTo:[],touchAgainst:[],sequence:[],videoStartTimeStamp:0,position:r.CENTER_LINE},g=(0,m.Ue)(e=>({...T,setTouchType:t=>e(e=>({type:t})),setPointAwardedTo:t=>e(e=>({pointAwardedTo:t})),setTouchAgainst:t=>e(e=>({touchAgainst:t})),setSequence:t=>e(e=>({sequence:t})),setVideoStartTimeStamp:t=>e(e=>({videoStartTimeStamp:t})),setVideoEndTimeStamp:t=>e(e=>({videoEndTimeStamp:t})),setFencingStartTime:t=>e(e=>({fencingStartTime:t})),setFencingEndTime:t=>e(e=>({fencingEndTime:t})),setPosition:t=>e(e=>({position:t})),getTouchType:()=>e(e=>({type:e.type})),getPointAwardedTo:()=>e(e=>({pointAwardedTo:e.pointAwardedTo})),getTouchAgainst:()=>e(e=>({touchAgainst:e.touchAgainst})),getSequence:()=>e(e=>({sequence:e.sequence})),getVideoStartTimeStamp:()=>e(e=>({videoStartTimeStamp:e.videoStartTimeStamp})),getVideoEndTimeStamp:()=>e(e=>({videoEndTimeStamp:e.videoEndTimeStamp})),getFencingStartTime:()=>e(e=>({fencingStartTime:e.fencingStartTime})),getFencingEndTime:()=>e(e=>({fencingEndTime:e.fencingEndTime})),getPosition:()=>e(e=>({position:e.position})),resetTouch:()=>e({...T})}));function b(e){return"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat(Math.floor(e%60).toString().padStart(2,"0"))}function v(){let e=g(e=>e.sequence),t=g(e=>e.setSequence),s=Object.values(a),n=s=>{t([...e,s])},l=s=>{let n=[...e];n.splice(s,1),t(n)};return(0,o.jsxs)("div",{className:"my-4 p-4",children:[(0,o.jsxs)("div",{className:"flex flex-row mb-2 h-9 items-center",children:["Touch sequence:",e.map((e,t)=>(0,o.jsxs)("div",{className:"badge badge-accent mx-2 ",children:[e,(0,o.jsx)("button",{className:"ml-2",onClick:()=>l(t),children:"X"})]},t))]}),(0,o.jsxs)("div",{children:[s.map(e=>(0,o.jsx)("button",{className:"btn btn-info btn-sm m-2",onClick:()=>n(e),children:e},e)),(0,o.jsx)("button",{className:"btn btn-sm btn-warning",onClick:()=>{t([])},children:"Clear Sequence"})]})]})}function E(){let e=g(e=>e.type)||null,t=u(e=>e.leftFencer),s=u(e=>e.rightFencer),n=e=>{switch(g.getState().setTouchType(e),e){case c.SINGLE_TOUCH_LEFT:g.getState().setPointAwardedTo([t]),g.getState().setTouchAgainst([s]);break;case c.SINGLE_TOUCH_RIGHT:g.getState().setPointAwardedTo([s]),g.getState().setTouchAgainst([t]);break;case c.DOUBLE_TOUCH:g.getState().setPointAwardedTo([u.getState().leftFencer,u.getState().rightFencer]);break;case c.NO_TOUCH:g.getState().setTouchAgainst([u.getState().leftFencer,u.getState().rightFencer])}};return(0,o.jsx)("div",{className:"my-2 p-4 flex justify-center",children:(0,o.jsxs)("div",{className:"flex",children:[(0,o.jsxs)("label",{className:"mr-3 flex",children:[(0,o.jsx)("input",{className:"mr-2 radio radio-primary",type:"radio",name:"touchType",value:c.SINGLE_TOUCH_LEFT,checked:e===c.SINGLE_TOUCH_LEFT,onChange:()=>n(c.SINGLE_TOUCH_LEFT)}),"Touch awarded to ",t.name]}),(0,o.jsxs)("label",{className:"mr-3 flex",children:[(0,o.jsx)("input",{className:"mr-2 radio radio-primary",type:"radio",name:"touchType",value:c.SINGLE_TOUCH_RIGHT,checked:e===c.SINGLE_TOUCH_RIGHT,onChange:()=>n(c.SINGLE_TOUCH_RIGHT)}),"Touch awarded to ",s.name]}),(0,o.jsxs)("label",{className:"mr-3 flex",children:[(0,o.jsx)("input",{className:"mr-2 radio radio-primary",type:"radio",name:"touchType",value:c.DOUBLE_TOUCH,checked:e===c.DOUBLE_TOUCH,onChange:()=>n(c.DOUBLE_TOUCH)}),"Double Touch"]}),(0,o.jsxs)("label",{className:"mr-3 flex",children:[(0,o.jsx)("input",{className:"mr-2 radio radio-primary",type:"radio",name:"touchType",value:c.NO_TOUCH,checked:e===c.NO_TOUCH,onChange:()=>n(c.NO_TOUCH)}),"No Touch"]})]})})}function S(){let e=g(e=>e.position),t=e=>{g.getState().setPosition(e)};return(0,o.jsxs)("div",{className:"text-center flex flex-col justify-center items-center",children:[(0,o.jsxs)("h1",{className:"text-lg font-semibold mb-2",children:["Piste Position: ",e]}),(0,o.jsxs)("div",{className:"flex w-[800px] h-24 border-gray-500 border-4 border-solid bg-gray-300 rounded-sm",children:[(0,o.jsx)("div",{onClick:()=>t(r.BACK_LINE_LEFT),className:"tooltip cursor-pointer h-full w-1/12","data-tip":r.BACK_LINE_LEFT}),(0,o.jsx)("div",{onClick:()=>t(r.WARNING_ZONE_LEFT),className:"tooltip cursor-pointer h-full w-3/12 border-solid border-red-500 border-l-2 border-r-2 bg-red-300","data-tip":r.WARNING_ZONE_LEFT}),(0,o.jsx)("div",{onClick:()=>t(r.NEAR_WARNING_LINE_LEFT),className:"tooltip cursor-pointer h-full w-2/12","data-tip":r.NEAR_WARNING_LINE_LEFT}),(0,o.jsx)("div",{onClick:()=>t(r.BEHIND_GUARD_LINE_LEFT),className:"tooltip cursor-pointer h-full w-2/12 border-solid border-gray border-l-2","data-tip":r.BEHIND_GUARD_LINE_LEFT}),(0,o.jsx)("div",{onClick:()=>t(r.LEFT_OF_CENTER_LINE),className:"tooltip cursor-pointer h-full w-4/12 border-solid border-white border-l-4 border-r-4","data-tip":r.LEFT_OF_CENTER_LINE}),(0,o.jsx)("div",{onClick:()=>t(r.CENTER_LINE),className:"tooltip cursor-pointer h-full w-[12px] border-black border-1 border-solid bg-gray-100","data-tip":r.CENTER_LINE}),(0,o.jsx)("div",{onClick:()=>t(r.RIGHT_OF_CENTER_LINE),className:"tooltip cursor-pointer h-full w-4/12 border-solid border-white border-l-4 border-r-4","data-tip":r.RIGHT_OF_CENTER_LINE}),(0,o.jsx)("div",{onClick:()=>t(r.BEHIND_GUARD_LINE_RIGHT),className:"tooltip cursor-pointer h-full w-2/12 border-solid border-gray border-r-2","data-tip":r.BEHIND_GUARD_LINE_RIGHT}),(0,o.jsx)("div",{onClick:()=>t(r.NEAR_WARNING_LINE_RIGHT),className:"tooltip cursor-pointer h-full w-2/12","data-tip":r.NEAR_WARNING_LINE_RIGHT}),(0,o.jsx)("div",{onClick:()=>t(r.WARNING_ZONE_RIGHT),className:"tooltip cursor-pointer h-full w-3/12 border-solid border-red-500 border-l-2 border-r-2 bg-red-300","data-tip":r.WARNING_ZONE_RIGHT}),(0,o.jsx)("div",{onClick:()=>t(r.BACK_LINE_RIGHT),className:"tooltip cursor-pointer h-full w-1/12","data-tip":r.BACK_LINE_RIGHT})]})]})}function y(){let e=u(e=>e.url),t=u(e=>e.playerRef),s=u(e=>e.title),n=u(e=>e.leftFencer),l=u(e=>e.rightFencer),i=g(e=>e.videoStartTimeStamp),r=u(e=>e.touches),[a,m]=(0,d.useState)(""),[h,x]=(0,d.useState)(!1),p=f(e=>e.setCurrentStep);(0,d.useEffect)(()=>{let e=e=>{g.getState().setVideoStartTimeStamp(e.playedSeconds)};if(t&&t.current){let s=t.current.getInternalPlayer("video");s&&s.addEventListener("progress",e)}return()=>{if(t&&t.current){let s=t.current.getInternalPlayer("video");s&&s.removeEventListener("progress",e)}}},[t]);let j=e=>{t.current&&t.current.seekTo(e)},T=[...r].sort((e,t)=>e.videoStartTimeStamp-t.videoStartTimeStamp),y=()=>u.getState().touches.length>0;return(0,o.jsxs)("div",{className:"flex flex-col w-full pb-24",children:[(0,o.jsxs)("div",{className:"flex flex-row items-center px-8 justify-between",children:[(0,o.jsx)("h1",{className:"text-xl font-semi-bold my-6",children:" Annotate Touches "}),(0,o.jsx)("button",{onClick:()=>{y()?p(3):console.error("Please add a touch to the video before proceeding.")},disabled:!y(),className:"btn btn-primary btn-large",children:"Submit Video"})]}),(0,o.jsxs)("div",{className:"flex flex-col w-full items-center",children:[(0,o.jsx)("h2",{className:"text-xl font-bold my-4",children:s}),(0,o.jsxs)("div",{className:"flex text-lg font-bold w-1/2 justify-between my-6",children:[(0,o.jsx)("p",{children:n.name}),(0,o.jsx)("p",{children:l.name})]}),(0,o.jsx)(N.Z,{ref:t,url:e,onPlaying:()=>{},controls:!0})]}),(0,o.jsx)("div",{className:"divider"}),(0,o.jsx)("div",{className:"flex justify-evenly",children:(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,o.jsxs)("div",{className:"flex flex-row items-center mb-4",children:[(0,o.jsx)("div",{children:"Touch start time:"}),(0,o.jsxs)("div",{className:"text-xl mx-2",children:[b(i)," "]})]}),(0,o.jsx)("button",{className:"btn btn-accent btn-sm mx-4",onClick:()=>{if(t.current){let e=Math.round(t.current.getCurrentTime());g.getState().setVideoStartTimeStamp(e)}},children:"Set Touch Start Time"})]})}),(0,o.jsx)("div",{className:"divider"}),(0,o.jsx)(v,{}),(0,o.jsx)(E,{}),(0,o.jsx)(S,{}),(0,o.jsx)("div",{className:"flex justify-center mt-8",children:(0,o.jsx)("button",{className:"btn btn-secondary btn-lg",onClick:()=>{!function(){let e=g.getState().type,t=g.getState().sequence,s=g.getState().videoStartTimeStamp;null!==e&&t.length>0&&0!==s?(u.getState().addTouch({type:g.getState().type,pointAwardedTo:g.getState().pointAwardedTo,touchAgainst:g.getState().touchAgainst,sequence:g.getState().sequence,videoStartTimeStamp:i,videoEndTimeStamp:g.getState().videoEndTimeStamp,fencingStartTime:g.getState().fencingStartTime,fencingEndTime:g.getState().fencingEndTime,position:g.getState().position}),g.getState().resetTouch(),x(!1)):(m("Please fill out all touch information before adding."),x(!0))}()},children:"Add Touch"})}),h&&(0,o.jsxs)("div",{role:"alert",className:"alert alert-error my-2 mx-auto w-1/2 flex justify-center",children:[(0,o.jsx)("svg",{onClick:()=>x(!1),xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6 cursor-pointer",fill:"none",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,o.jsx)("span",{children:a})]}),(0,o.jsx)("div",{className:"divider"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"text-2xl font-semibold px-8",children:"Touches"}),(0,o.jsx)("div",{children:T.map((e,t)=>(0,o.jsxs)("div",{className:"w-full px-4",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,o.jsxs)("h2",{className:"mr-2",children:["Touch ",t+1," - ",b(e.videoStartTimeStamp)]}),(0,o.jsx)("p",{children:e.type}),e.type===c.SINGLE_TOUCH_LEFT||e.type===c.SINGLE_TOUCH_RIGHT?(0,o.jsxs)("p",{children:["for ",e.pointAwardedTo.map(e=>e.name).join(", ")]}):null,(0,o.jsxs)("p",{className:"flex-shrink-0 ml-6",children:["Sequence: ",e.sequence.join(", ")]}),(0,o.jsxs)("p",{className:"flex-shrink-0 ml-6",children:["Piste Position: ",e.position]})]}),(0,o.jsx)("button",{className:"btn btn-info btn-circle btn-small",onClick:()=>j(e.videoStartTimeStamp),children:"Seek To"}),(0,o.jsx)("button",{className:"btn btn-warning btn-circle btn-small",onClick:()=>{u.getState().removeTouch(e)},children:"\uD83D\uDDD1️"})]}),(0,o.jsx)("div",{className:"divider w-full"})]},t))})]})]})}function _(){let e=u(e=>e.title),t=u(e=>e.leftFencer),s=u(e=>e.rightFencer),n=f(e=>e.setCurrentStep),l=u(e=>e),[i,r]=(0,d.useState)(!1),a=[...u(e=>e.touches)].sort((e,t)=>e.videoStartTimeStamp-t.videoStartTimeStamp),m=async()=>{let{id:e,club:t,title:s,leftFencer:n,rightFencer:i,touches:r}=l;console.log({id:e,club:t,title:s,leftFencer:n,rightFencer:i,touches:r});let a=document.getElementById("create-video-modal");a&&a.showModal()},h=async()=>{let{id:e,club:t,title:s,leftFencer:i,rightFencer:a,touches:c}=l;r(!0);try{await fetch("/api/videos",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id:e,club:t,title:s,leftFencer:i,rightFencer:a,touches:c})}).then(e=>e.json()).then(()=>u.getState().resetVideo()).then(()=>r(!1)).then(()=>n(0)).catch(()=>{console.error("Error saving video")})}catch(t){console.error("Error saving video:",t),r(!1);let e=document.getElementById("create-video-modal");e&&e.close()}finally{r(!1);let e=document.getElementById("create-video-modal");e&&e.close()}};return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:" flex w-full justify-evenly mb-4",children:[(0,o.jsx)("button",{onClick:function(){n(2)},className:"btn btn-secondary",children:"Back"}),(0,o.jsx)("button",{onClick:()=>m(),className:"btn btn-primary",children:"Save Video"}),(0,o.jsx)("dialog",{id:"create-video-modal",className:"modal",children:(0,o.jsxs)("div",{className:"modal-box flex flex-col w-full",children:[(0,o.jsx)("h3",{className:"font-bold text-lg",children:"Are you sure?"}),(0,o.jsxs)("div",{className:"modal-action flex w-full justify-between",children:[(0,o.jsx)("form",{method:"dialog",children:(0,o.jsx)("button",{className:"btn btn-danger",children:"Nope"})}),(0,o.jsx)("button",{className:"btn btn-accent",onClick:()=>h(),children:i?"Saving...":"Save Video"})]})]})})]}),(0,o.jsxs)("h1",{className:"text-2xl font-semibold px-8 mb-2",children:["Video:",(0,o.jsx)("span",{className:"font-normal text-xl ml-2",children:e})]}),(0,o.jsxs)("h1",{className:"text-2xl font-semibold px-8 mb-2",children:["Fencers:",(0,o.jsxs)("span",{className:"font-normal text-xl ml-2",children:[t.name," & ",s.name]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"text-2xl font-semibold px-8 mb-2",children:"Touches"}),(0,o.jsx)("div",{className:"px-10",children:a.map((e,t)=>(0,o.jsxs)("div",{className:"w-full px-4",children:[(0,o.jsx)("div",{className:"flex justify-between items-center",children:(0,o.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,o.jsxs)("h2",{className:"mr-2",children:["Touch ",t+1," - ",b(e.videoStartTimeStamp)]}),(0,o.jsx)("p",{children:e.type}),e.type===c.SINGLE_TOUCH_LEFT||e.type===c.SINGLE_TOUCH_RIGHT?(0,o.jsxs)("p",{children:["for ",e.pointAwardedTo.map(e=>e.name).join(", ")]}):null,(0,o.jsxs)("p",{className:"flex-shrink-0 ml-6",children:["Sequence: ",e.sequence.join(", ")]}),(0,o.jsxs)("p",{className:"flex-shrink-0 ml-6",children:["Piste Position: ",e.position]})]})}),(0,o.jsx)("div",{className:"divider w-full"})]},t))})]})]})}(l=a||(a={})).ATTACK="Attack",l.TOUCH="Touch",l.PARRY="Parry",l.RIPOSTE="Riposte",l.COUNTER="Counter",l.BEAT="Beat",l.LINE="Line",l.NO="No",l.SIMULTANEOUS="Simultaneous",l.REMISE="Remise",(i=c||(c={})).SINGLE_TOUCH_LEFT="Touch Left",i.SINGLE_TOUCH_RIGHT="Touch Right",i.DOUBLE_TOUCH="Double Touch",i.NO_TOUCH="No Touch";let C="force-dynamic",L="force-no-store";function w(){let e=f(e=>e.currentStep),t=[{label:"Choose Video",components:[(0,o.jsx)(j,{})]},{label:"Select Fencers",components:[(0,o.jsx)(p,{})]},{label:"Annotate Touches",components:[(0,o.jsx)(y,{})]},{label:"Submit",components:[(0,o.jsx)(_,{})]}];return(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"text-3xl px-8 mt-4",children:"Video Annotator"}),(0,o.jsx)("ul",{className:"steps w-full my-6",children:t.map((t,s)=>(0,o.jsx)("li",{className:"step ".concat(s<=e?"step-primary":""),children:t.label},s))}),(0,o.jsx)("div",{className:"divider mb-6"}),t.map((t,s)=>s===e&&t.components.map((e,t)=>(0,o.jsx)("div",{children:e},t)))]})}}},function(e){e.O(0,[81,971,938,744],function(){return e(e.s=7891)}),_N_E=e.O()}]);